-- ScriptID do DRIP CLIENT
getgenv().ScriptID = "DRIP_CLIENT_2024"
local LocalPlayer = game.Players.LocalPlayer
LocalPlayer:SetAttribute("ScriptID", getgenv().ScriptID)

-- Estado
local ESPObjects = {}
local ESPEnabled = false
local DripUsers = {}

-- Funções de ESP
local function CreateDripESP(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local BillboardGui = Instance.new("BillboardGui")
        BillboardGui.Name = "DripESP"
        BillboardGui.Adornee = player.Character.HumanoidRootPart
        BillboardGui.Size = UDim2.new(0, 100, 0, 20)
        BillboardGui.StudsOffset = Vector3.new(0, 3, 0)
        BillboardGui.AlwaysOnTop = true

        local TextLabel = Instance.new("TextLabel")
        TextLabel.Size = UDim2.new(1, 0, 1, 0)
        TextLabel.BackgroundTransparency = 1
        TextLabel.Text = "✅ DRIP"
        TextLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        TextLabel.TextStrokeTransparency = 0.5
        TextLabel.Font = Enum.Font.SourceSansBold
        TextLabel.TextScaled = true
        TextLabel.Parent = BillboardGui

        BillboardGui.Parent = player.Character
        ESPObjects[player] = BillboardGui
    end
end

local function RemoveDripESP(player)
    if ESPObjects[player] then
        ESPObjects[player]:Destroy()
        ESPObjects[player] = nil
    end
end

local function DetectarDripUsers()
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= LocalPlayer and player:GetAttribute("ScriptID") == getgenv().ScriptID then
            if not DripUsers[player.Name] then
                DripUsers[player.Name] = true
                if ESPEnabled then
                    CreateDripESP(player)
                end
            end
        end
    end
end

-- Loop de detecção automática
task.spawn(function()
    while true do
        DetectarDripUsers()
        task.wait(3)
    end
end)

-- Botão na aba
local Toggle = Tabs.H:AddToggle({
	Name = "ESP: DRIP CLIENT",
	Description = "Mostra jogadores usando o mesmo script",
	Default = false
})

Toggle:Callback(function(Value)
	ESPEnabled = Value
	for playerName, _ in pairs(DripUsers) do
		local player = game.Players:FindFirstChild(playerName)
		if player then
			if ESPEnabled then
				CreateDripESP(player)
			else
				RemoveDripESP(player)
			end
		end
	end
end)
