-- DRIP CLIENT ESP System com RedzLib e identifica√ß√£o segura entre usu√°rios reais
getgenv().ScriptID = "DRIP_CLIENT_2024"

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- Marcar jogador com ScriptID
pcall(function()
	LocalPlayer:SetAttribute("ScriptID", getgenv().ScriptID)
end)

-- Carregar RedzLib
local redzlibContent = game:HttpGet("https://raw.githubusercontent.com/realgengar/SpeedLegends-/refs/heads/main/RedzV5.Lua", true)
local redzlib = loadstring(redzlibContent)()
if not redzlib then error("Falha ao carregar redzlib") end

workspace.FallenPartsDestroyHeight = -math.huge

-- Configura√ß√£o do ESP
local ESP_CONFIG = {
	ESP_ID = getgenv().ScriptID,
	MaxDistance = 800,
	UpdateRate = 0.15,
	TextSize = 16,
	ClientColor = Color3.fromRGB(255, 0, 255),
	GlowColor = Color3.fromRGB(255, 100, 255)
}

-- Vari√°veis internas
local ESPObjects = {}
local ESPEnabled = false
local UpdateConnection = nil
local LastUpdate = 0
local DripUsers = {}

-- Criar RemoteEvent
local function GetOrCreateRemote()
	local remote = ReplicatedStorage:FindFirstChild("DripClientIdentifier")
	if not remote then
		remote = Instance.new("RemoteEvent")
		remote.Name = "DripClientIdentifier"
		remote.Parent = ReplicatedStorage
	end
	return remote
end

local DripRemote = GetOrCreateRemote()

-- Enviar broadcast para outros scripts
local function BroadcastDripClient()
	DripRemote:FireAllClients(LocalPlayer, "DRIP_CLIENT_ACTIVE", getgenv().ScriptID)
end

-- Receber identifica√ß√£o de outros
DripRemote.OnClientEvent:Connect(function(fromPlayer, message, scriptID)
	if message == "DRIP_CLIENT_ACTIVE" and scriptID == getgenv().ScriptID and fromPlayer ~= LocalPlayer then
		DripUsers[fromPlayer.Name] = {
			HasDrip = true,
			DetectedAt = tick(),
			LastSeen = tick(),
			Verified = true
		}
		if ESPEnabled and not ESPObjects[fromPlayer] then
			CreateDripESP(fromPlayer)
		end
	end
end)

-- Enviar periodicamente
task.spawn(function()
	wait(2)
	BroadcastDripClient()
	while true do
		wait(30)
		BroadcastDripClient()
	end
end)

-- Verifica√ß√£o
local function PlayerHasDripClient(player)
	local data = DripUsers[player.Name]
	if data and data.Verified then
		data.LastSeen = tick()
		return true
	end
	return false
end

-- Remover ESP
function RemoveDripESP(player)
	if ESPObjects[player] then
		local gui = ESPObjects[player].BillboardGui
		if gui and gui:FindFirstChild("DripLabel") then
			TweenService:Create(gui.DripLabel, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
			task.delay(0.3, function() gui:Destroy() end)
		else
			gui:Destroy()
		end
		ESPObjects[player] = nil
	end
end


-- Cria o ESP visual
function CreateDripESP(player)
	if player == LocalPlayer or ESPObjects[player] or not PlayerHasDripClient(player) then return end
	local char = player.Character
	if not char then return end

	local head = char:FindFirstChild("Head")
	if not head then return end

	local gui = Instance.new("BillboardGui")
	gui.Name = "DripESP_" .. player.Name
	gui.Adornee = head
	gui.Size = UDim2.new(0, 200, 0, 50)
	gui.StudsOffset = Vector3.new(0, 2.5, 0)
	gui.AlwaysOnTop = true
	gui.Parent = head

	local label = Instance.new("TextLabel", gui)
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = "DRIP CLIENT"
	label.TextColor3 = ESP_CONFIG.ClientColor
	label.Font = Enum.Font.Code
	label.TextSize = ESP_CONFIG.TextSize
	label.TextStrokeTransparency = 0
	label.TextStrokeColor3 = Color3.new(0,0,0)

	ESPObjects[player] = {
		BillboardGui = gui,
		Label = label,
		Head = head,
		CreatedAt = tick()
	}
end

-- Atualiza o ESP visualmente
local function UpdateDripESP()
	if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
	local myPos = LocalPlayer.Character.HumanoidRootPart.Position
	local timeNow = tick()

	for player, data in pairs(ESPObjects) do
		local char = player.Character
		if not char or not data.Head or not data.Head.Parent then
			RemoveDripESP(player)
		else
			local dist = (char.HumanoidRootPart.Position - myPos).Magnitude
			data.BillboardGui.Enabled = dist <= ESP_CONFIG.MaxDistance

			local pulse = 0.8 + 0.2 * math.sin(timeNow * 4)
			data.Label.TextColor3 = Color3.fromRGB(
				math.floor(255 * pulse), 0, math.floor(255 * pulse)
			)
		end
	end
end

-- Loop de verifica√ß√£o de ESP
local function ToggleDripESP(enabled)
	ESPEnabled = enabled

	if ESPEnabled then
		print("‚úÖ DRIP CLIENT ESP ON")
		for _, player in pairs(Players:GetPlayers()) do
			if player ~= LocalPlayer and player.Character then
				CreateDripESP(player)
			end
		end
		UpdateConnection = RunService.Heartbeat:Connect(function()
			local now = tick()
			if now - LastUpdate >= ESP_CONFIG.UpdateRate then
				UpdateDripESP()
				LastUpdate = now
			end
		end)
	else
		print("‚ùå DRIP CLIENT ESP OFF")
		if UpdateConnection then
			UpdateConnection:Disconnect()
			UpdateConnection = nil
		end
		for player, _ in pairs(ESPObjects) do
			RemoveDripESP(player)
		end
	end
end

-- Detecta novos jogadores entrando
Players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function()
		task.wait(1)
		if ESPEnabled then
			CreateDripESP(player)
		end
	end)
end)

-- Limpeza ao sair
Players.PlayerRemoving:Connect(function(player)
	RemoveDripESP(player)
	DripUsers[player.Name] = nil
end)

-- Loop para recarregar ESP caso o personagem reinicie
task.spawn(function()
	while true do
		task.wait(2)
		if ESPEnabled then
			for player, data in pairs(ESPObjects) do
				if player.Character ~= data.Character then
					RemoveDripESP(player)
					CreateDripESP(player)
				end
			end
		end
	end
end)

-- REDZLIB UI
local Window = redzlib:MakeWindow({
	Title = "Drip Client : Brookhaven",
	SubTitle = "by: Magnus999",
	SaveFolder = "redz Hub | Brookhaven RP.lua"
})

Window:AddMinimizeButton({})

local Tabs = {
	M = Window:MakeTab({"Informa√ß√µes", "Info"}),
	H = Window:MakeTab({"In√≠cio", "flower"})
}

-- Toggle do ESP
local ESPToggle = Tabs.H:AddToggle({
	Name = "DRIP CLIENT ESP",
	Description = "Mostra 'DRIP CLIENT' em jogadores com o mesmo script",
	Default = false
})

ESPToggle:Callback(function(state)
	ToggleDripESP(state)
end)

-- Info
Tabs.M:AddParagraph({
	Title = "üî• DRIP CLIENT ESP",
	Description = "Detecta SOMENTE jogadores usando o mesmo script com ESP_ID igual.\n\n‚Ä¢ Comunica√ß√£o segura via RemoteEvent\n‚Ä¢ Identifica√ß√£o real entre usu√°rios\n‚Ä¢ Visual pulsante rosa + nome"
})

Tabs.M:AddParagraph({
	Title = "‚ÑπÔ∏è Sobre",
	Description = "Todos os efeitos s√≥ aparecem para quem compartilha o mesmo c√≥digo.\nScripts diferentes n√£o se reconhecem."
})

print("‚úÖ DRIP CLIENT Loaded com ESP seguro por ScriptID!")
