local redzlibContent = game:HttpGet("https://raw.githubusercontent.com/realgengar/SpeedLegends-/refs/heads/main/RedzV5.Lua", true)
local redzlib = loadstring(redzlibContent)()
if not redzlib then error("Falha ao carregar redzlib") end

workspace.FallenPartsDestroyHeight = -math.huge

local Window = redzlib:MakeWindow({
    Title = "Drip Client : Brookhaven ",
    SubTitle = "          by: Magnus999",
    SaveFolder = "redz Hub | Brookhaven RP.lua"
})

Window:AddMinimizeButton({
	Button = {
		Image = "rbxassetid://72495850369898"
	},
	Corner = {
		CornerRadius = UDim.new(0, 2)
	},
	Stroke = {
		Color = Color3.new(0, 0, 0),
		Transparency = 1,
		Thickness = 1
	}
})

local Tabs = {
    M = Window:MakeTab({"Informa√ß√µes", "Info"}),
    H = Window:MakeTab({"In√≠cio", "flower"})
}

-- Configura√ß√£o similar ao admin.lua
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

getgenv().ScriptID = "DRIP_CLIENT_2024"

-- Sistema de RemoteEvents (igual ao admin.lua)
local function setupRemoteEvents()
    local dripRemote = ReplicatedStorage:FindFirstChild("DripClientRemote")
    if not dripRemote then
        dripRemote = Instance.new("RemoteEvent")
        dripRemote.Name = "DripClientRemote"
        dripRemote.Parent = ReplicatedStorage
    end
    
    local dripBindable = ReplicatedStorage:FindFirstChild("DripClientBindable")
    if not dripBindable then
        dripBindable = Instance.new("BindableEvent")
        dripBindable.Name = "DripClientBindable"
        dripBindable.Parent = ReplicatedStorage
    end
    
    return dripRemote, dripBindable
end

local dripRemote, dripBindable = setupRemoteEvents()

-- Sistema de broadcast (similar ao admin.lua)
local function broadcastPresence()
    local data = {
        action = "announce_presence",
        player = LocalPlayer.Name,
        scriptId = getgenv().ScriptID
    }
    
    -- Tentar m√∫ltiplos m√©todos como no admin.lua
    pcall(function()
        processPresenceData(data)
    end)
    
    pcall(function()
        dripRemote:FireServer(data)
    end)
    
    pcall(function()
        dripBindable:Fire(data)
    end)
end

-- Estado
local ESPObjects = {}
local ESPEnabled = false
local DripUsers = {}

-- Fun√ß√£o para processar dados de presen√ßa
function processPresenceData(data)
    if not data then return end
    
    if data.action == "announce_presence" and data.scriptId == getgenv().ScriptID then
        local playerName = data.player
        local player = Players:FindFirstChild(playerName)
        
        if player and player ~= LocalPlayer then
            if not DripUsers[playerName] then
                DripUsers[playerName] = true
                print("Novo usu√°rio Drip detectado via RemoteEvent:", playerName)
                
                if ESPEnabled then
                    CreateDripESP(player)
                end
            end
        end
    end
end

-- Conectar eventos (igual ao admin.lua)
dripRemote.OnClientEvent:Connect(function(data)
    processPresenceData(data)
end)

dripBindable.Event:Connect(function(data)
    processPresenceData(data)
end)

-- Fun√ß√µes de ESP melhoradas
local function CreateDripESP(player)
    RemoveDripESP(player)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local BillboardGui = Instance.new("BillboardGui")
        BillboardGui.Name = "DripESP"
        BillboardGui.Adornee = player.Character.HumanoidRootPart
        BillboardGui.Size = UDim2.new(0, 120, 0, 25)
        BillboardGui.StudsOffset = Vector3.new(0, 3, 0)
        BillboardGui.AlwaysOnTop = true
        
        local TextLabel = Instance.new("TextLabel")
        TextLabel.Size = UDim2.new(1, 0, 1, 0)
        TextLabel.BackgroundTransparency = 1
        TextLabel.Text = "‚úÖ DRIP CLIENT"
        TextLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        TextLabel.TextStrokeTransparency = 0.5
        TextLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        TextLabel.Font = Enum.Font.SourceSansBold
        TextLabel.TextScaled = true
        TextLabel.Parent = BillboardGui
        
        BillboardGui.Parent = player.Character
        ESPObjects[player] = BillboardGui
        
        print("ESP criado para:", player.Name)
    end
end

local function RemoveDripESP(player)
    if ESPObjects[player] then
        ESPObjects[player]:Destroy()
        ESPObjects[player] = nil
        print("ESP removido para:", player.Name)
    end
end

-- Definir atributo e anunciar presen√ßa
local function announceMyPresence()
    LocalPlayer:SetAttribute("ScriptID", getgenv().ScriptID)
    broadcastPresence()
    print("Presen√ßa anunciada para:", LocalPlayer.Name)
end

-- Anunciar presen√ßa quando spawnar
local function onCharacterAdded()
    task.wait(2) -- Aguardar personagem carregar
    announceMyPresence()
end

-- Conectar eventos de spawn
LocalPlayer.CharacterAdded:Connect(onCharacterAdded)
if LocalPlayer.Character then
    onCharacterAdded()
end

-- Detec√ß√£o tradicional por atributos (backup)
local function DetectarDripUsers()
    local foundUsers = 0
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local playerScriptID = player:GetAttribute("ScriptID")
            
            if playerScriptID == getgenv().ScriptID then
                foundUsers = foundUsers + 1
                
                if not DripUsers[player.Name] then
                    DripUsers[player.Name] = true
                    print("Usu√°rio Drip detectado via atributo:", player.Name)
                    
                    if ESPEnabled then
                        CreateDripESP(player)
                    end
                end
            else
                if DripUsers[player.Name] then
                    DripUsers[player.Name] = nil
                    RemoveDripESP(player)
                    print("Usu√°rio Drip removido:", player.Name)
                end
            end
        end
    end
    
    if foundUsers > 0 then
        print("Total de usu√°rios Drip encontrados:", foundUsers)
    end
end

-- Eventos para jogadores entrando/saindo
Players.PlayerAdded:Connect(function(player)
    print("Jogador entrou:", player.Name)
    task.wait(3)
    DetectarDripUsers()
    
    -- Anunciar nossa presen√ßa para o novo jogador
    announceMyPresence()
    
    -- Conectar ao spawn do novo jogador
    player.CharacterAdded:Connect(function()
        task.wait(1)
        if DripUsers[player.Name] and ESPEnabled then
            CreateDripESP(player)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(player)
    print("Jogador saiu:", player.Name)
    if DripUsers[player.Name] then
        DripUsers[player.Name] = nil
        RemoveDripESP(player)
    end
end)

-- Para jogadores j√° no jogo
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        player.CharacterAdded:Connect(function()
            task.wait(1)
            if DripUsers[player.Name] and ESPEnabled then
                CreateDripESP(player)
            end
        end)
    end
end

-- Loop de detec√ß√£o e an√∫ncio (mais frequente que antes)
task.spawn(function()
    while true do
        DetectarDripUsers()
        announceMyPresence() -- Anunciar presen√ßa regularmente
        task.wait(3) -- Intervalo menor para melhor sincroniza√ß√£o
    end
end)

-- Bot√£o ESP
local Toggle = Tabs.H:AddToggle({
	Name = "ESP: DRIP CLIENT",
	Description = "Mostra jogadores usando o mesmo script",
	Default = false
})

Toggle:Callback(function(Value)
	ESPEnabled = Value
	print("ESP", Value and "ativado" or "desativado")
	
	for playerName, _ in pairs(DripUsers) do
		local player = Players:FindFirstChild(playerName)
		if player then
			if ESPEnabled then
				CreateDripESP(player)
			else
				RemoveDripESP(player)
			end
		end
	end
end)

-- Bot√£o para for√ßar an√∫ncio
Tabs.M:AddButton({
    Name = "üì¢ Anunciar Presen√ßa",
    Description = "For√ßa o an√∫ncio da sua presen√ßa",
    Callback = function()
        announceMyPresence()
        print("Presen√ßa anunciada manualmente!")
    end
})

-- Bot√£o de debug melhorado
Tabs.M:AddButton({
    Name = "üîç Debug: Verificar Usu√°rios",
    Description = "Mostra informa√ß√µes detalhadas de debug",
    Callback = function()
        print("=== DEBUG DRIP CLIENT ===")
        print("Meu ScriptID:", getgenv().ScriptID)
        print("Meu atributo:", LocalPlayer:GetAttribute("ScriptID"))
        print("Usu√°rios Drip detectados:", 0)
        for name, _ in pairs(DripUsers) do
            print("- " .. name)
        end
        
        print("\n--- Verifica√ß√£o de RemoteEvents ---")
        print("DripRemote existe:", dripRemote ~= nil)
        print("DripBindable existe:", dripBindable ~= nil)
        
        print("\n--- Todos os jogadores ---")
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                local attr = player:GetAttribute("ScriptID")
                print("Jogador:", player.Name, "| ScriptID:", attr or "nenhum")
            end
        end
        print("========================")
    end
})

-- Bot√£o para limpar ESPs
Tabs.M:AddButton({
    Name = "üßπ Limpar ESPs",
    Description = "Remove todos os ESPs e redefine usu√°rios",
    Callback = function()
        for player, _ in pairs(ESPObjects) do
            RemoveDripESP(player)
        end
        DripUsers = {}
        print("ESPs limpos e usu√°rios redefinidos!")
    end
})

-- Teste inicial
print("Drip Client carregado para:", LocalPlayer.Name)
print("ScriptID configurado:", getgenv().ScriptID)
print("Anunciando presen√ßa inicial...")
announceMyPresence()
