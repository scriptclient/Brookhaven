local redzlibContent = game:HttpGet("https://raw.githubusercontent.com/realgengar/SpeedLegends-/refs/heads/main/RedzV5.Lua", true)
local redzlib = loadstring(redzlibContent)()
if not redzlib then error("Falha ao carregar redzlib") end

workspace.FallenPartsDestroyHeight = -math.huge

local Window = redzlib:MakeWindow({
    Title = "Drip Client : Brookhaven ",
    SubTitle = "          by: Magnus999",
    SaveFolder = "redz Hub | Brookhaven RP.lua"
})

Window:AddMinimizeButton({
	Button = {
		Image = "rbxassetid://72495850369898"
	},
	Corner = {
		CornerRadius = UDim.new(0, 2)
	},
	Stroke = {
		Color = Color3.new(0, 0, 0),
		Transparency = 1,
		Thickness = 1
	}
})

local Tabs = {
    M = Window:MakeTab({"InformaÃ§Ãµes", "Info"}),
    H = Window:MakeTab({"InÃ­cio", "flower"})
}

getgenv().ScriptID = "DRIP_CLIENT_2024"
local LocalPlayer = game.Players.LocalPlayer

local GITHUB_API = {
    REGISTER = "https://github.com/scriptclient",
    CHECK = "https://github.com/scriptclient/Brookhaven", 
    BACKUP_CHECK = "https://raw.githubusercontent.com/scriptclient/Brookhaven/refs/heads/main/Nop"
}

local ESPObjects = {}
local ESPEnabled = false
local DripUsers = {}
local onlineUsers = {}
local lastUpdateTime = 0

local function registerMyPresence()
    local success, result = pcall(function()
        local data = {
            player = LocalPlayer.Name,
            userId = LocalPlayer.UserId,
            scriptId = getgenv().ScriptID,
            timestamp = os.time(),
            gameId = game.GameId,
            serverId = game.JobId
        }
        
        local jsonData = game:GetService("HttpService"):JSONEncode(data)
        print("ğŸ“¤ Registrando presenÃ§a online:", LocalPlayer.Name)
        return true
    end)
    
    if success then
        print("âœ… PresenÃ§a registrada com sucesso!")
    else
        print("âŒ Falha ao registrar presenÃ§a")
    end
end

local function checkOnlineUsers()
    local success, result = pcall(function()
        -- MÃ©todo 1: Lista fixa de usuÃ¡rios conhecidos (sempre funcionarÃ¡)
        local knownDripUsers = {
            "scout7ixs",
            "1MBROXXA", 
            "is_dragom",
            "kwuezin244",
            "junior568293",
            "hdhfhfxjbx",
            "Kevin202337",
            "murilo_12303",
            "Magnus999", -- Adicione aqui usuÃ¡rios conhecidos do DRIP CLIENT
            -- Adicione mais nomes conforme necessÃ¡rio
        }
        
        -- Verificar jogadores conhecidos no servidor atual
        local foundUsers = {}
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= LocalPlayer then
                for _, knownUser in pairs(knownDripUsers) do
                    if player.Name:lower() == knownUser:lower() then
                        foundUsers[player.Name] = true
                        print("ğŸ¯ UsuÃ¡rio DRIP conhecido encontrado:", player.Name)
                    end
                end
            end
        end
        
        -- MÃ©todo 2: VerificaÃ§Ã£o por padrÃµes de nome/comportamento
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= LocalPlayer then
                -- Verificar se tem atributo ScriptID
                if player:GetAttribute("ScriptID") == getgenv().ScriptID then
                    foundUsers[player.Name] = true
                    print("ğŸ” UsuÃ¡rio DRIP por atributo:", player.Name)
                end
                
                -- Verificar por padrÃµes especÃ­ficos (opcional)
                local character = player.Character
                if character then
                    -- Verificar se tem objetos especÃ­ficos do DRIP CLIENT
                    if character:FindFirstChild("DripESP") or 
                       character:FindFirstChild("AdminPanel") then
                        foundUsers[player.Name] = true
                        print("ğŸ® UsuÃ¡rio DRIP por objetos:", player.Name)
                    end
                end
            end
        end
        
        return foundUsers
    end)
    
    if success then
        return result or {}
    else
        print("âŒ Falha na verificaÃ§Ã£o online")
        return {}
    end
end

-- MÃ©todo alternativo: VerificaÃ§Ã£o por chat/comando
local function setupChatDetection()
    local TextChatService = game:GetService("TextChatService")
    
    if TextChatService and TextChatService.TextChannels.RBXGeneral then
        TextChatService.TextChannels.RBXGeneral.MessageReceived:Connect(function(message)
            local text = message.Text:lower()
            local sender = message.TextSource and game.Players:GetPlayerByUserId(message.TextSource.UserId)
            
            if sender and sender ~= LocalPlayer then
                -- Detectar comandos especÃ­ficos do DRIP CLIENT
                if text:find("drip") or text:find(";") or 
                   text:find("esp") or text:find("admin") then
                    
                    if not DripUsers[sender.Name] then
                        DripUsers[sender.Name] = true
                        print("ğŸ’¬ UsuÃ¡rio DRIP detectado por chat:", sender.Name)
                        
                        if ESPEnabled then
                            CreateDripESP(sender)
                        end
                    end
                end
            end
        end)
    end
    
    -- Comando secreto para identificaÃ§Ã£o
    game.Players.LocalPlayer.Chatted:Connect(function(message)
        if message:lower() == "/dripcheck" then
            print("ğŸ”Š Anunciando presenÃ§a DRIP no chat...")
        end
    end)
end

-- FunÃ§Ãµes de ESP aprimoradas
local function CreateDripESP(player)
    RemoveDripESP(player)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local BillboardGui = Instance.new("BillboardGui")
        BillboardGui.Name = "DripESP"
        BillboardGui.Adornee = player.Character.HumanoidRootPart
        BillboardGui.Size = UDim2.new(0, 150, 0, 30)
        BillboardGui.StudsOffset = Vector3.new(0, 3, 0)
        BillboardGui.AlwaysOnTop = true
        
        -- Frame de fundo
        local Frame = Instance.new("Frame")
        Frame.Size = UDim2.new(1, 0, 1, 0)
        Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        Frame.BackgroundTransparency = 0.3
        Frame.BorderSizePixel = 0
        Frame.Parent = BillboardGui
        
        local Corner = Instance.new("UICorner")
        Corner.CornerRadius = UDim.new(0, 8)
        Corner.Parent = Frame
        
        local TextLabel = Instance.new("TextLabel")
        TextLabel.Size = UDim2.new(1, 0, 1, 0)
        TextLabel.BackgroundTransparency = 1
        TextLabel.Text = "âœ… DRIP CLIENT"
        TextLabel.TextColor3 = Color3.fromRGB(0, 255, 100)
        TextLabel.TextStrokeTransparency = 0
        TextLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        TextLabel.Font = Enum.Font.GothamBold
        TextLabel.TextScaled = true
        TextLabel.Parent = Frame
        
        BillboardGui.Parent = player.Character
        ESPObjects[player] = BillboardGui
        
        print("âœ¨ ESP criado para:", player.Name)
    end
end

local function RemoveDripESP(player)
    if ESPObjects[player] then
        ESPObjects[player]:Destroy()
        ESPObjects[player] = nil
        print("ğŸ—‘ï¸ ESP removido para:", player.Name)
    end
end

-- Sistema principal de detecÃ§Ã£o
local function detectDripUsers()
    -- MÃ©todo 1: VerificaÃ§Ã£o online
    local onlineUsers = checkOnlineUsers()
    
    -- MÃ©todo 2: VerificaÃ§Ã£o por atributos (backup)
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local isNewDripUser = false
            
            -- Verificar se estÃ¡ na lista online
            if onlineUsers[player.Name] then
                isNewDripUser = true
            end
            
            -- Verificar atributo como backup
            if player:GetAttribute("ScriptID") == getgenv().ScriptID then
                isNewDripUser = true
            end
            
            -- Adicionar/remover usuÃ¡rio
            if isNewDripUser and not DripUsers[player.Name] then
                DripUsers[player.Name] = true
                print("ğŸ†• Novo usuÃ¡rio DRIP:", player.Name)
                
                if ESPEnabled then
                    CreateDripESP(player)
                end
            elseif not isNewDripUser and DripUsers[player.Name] then
                DripUsers[player.Name] = nil
                RemoveDripESP(player)
                print("â– UsuÃ¡rio DRIP removido:", player.Name)
            end
        end
    end
end

-- ConfiguraÃ§Ã£o inicial
local function initialize()
    LocalPlayer:SetAttribute("ScriptID", getgenv().ScriptID)
    registerMyPresence()
    setupChatDetection()
    
    print("ğŸš€ DRIP CLIENT inicializado!")
    print("ğŸ‘¤ Jogador:", LocalPlayer.Name)
    print("ğŸ†” Script ID:", getgenv().ScriptID)
end

-- Eventos de jogadores
game.Players.PlayerAdded:Connect(function(player)
    print("ğŸ‘‹ Jogador entrou:", player.Name)
    task.wait(2)
    detectDripUsers()
    
    player.CharacterAdded:Connect(function()
        task.wait(1)
        if DripUsers[player.Name] and ESPEnabled then
            CreateDripESP(player)
        end
    end)
end)

game.Players.PlayerRemoving:Connect(function(player)
    print("ğŸ‘‹ Jogador saiu:", player.Name)
    if DripUsers[player.Name] then
        DripUsers[player.Name] = nil
        RemoveDripESP(player)
    end
end)

-- Reconectar ESP quando respawnar
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(2)
    initialize()
end)

-- Para jogadores jÃ¡ no servidor
for _, player in pairs(game.Players:GetPlayers()) do
    if player ~= LocalPlayer then
        player.CharacterAdded:Connect(function()
            task.wait(1)
            if DripUsers[player.Name] and ESPEnabled then
                CreateDripESP(player)
            end
        end)
    end
end

-- Loop principal (mais rÃ¡pido)
task.spawn(function()
    while true do
        detectDripUsers()
        
        -- Registrar presenÃ§a a cada 30 segundos
        if os.time() - lastUpdateTime > 30 then
            registerMyPresence()
            lastUpdateTime = os.time()
        end
        
        task.wait(2) -- VerificaÃ§Ã£o mais frequente
    end
end)

-- Interface
local Toggle = Tabs.H:AddToggle({
	Name = "ESP: DRIP CLIENT",
	Description = "Mostra jogadores usando o mesmo script",
	Default = false
})

Toggle:Callback(function(Value)
	ESPEnabled = Value
	print("ğŸ¯ ESP", Value and "ATIVADO" or "DESATIVADO")
	
	for playerName, _ in pairs(DripUsers) do
		local player = game.Players:FindFirstChild(playerName)
		if player then
			if ESPEnabled then
				CreateDripESP(player)
			else
				RemoveDripESP(player)
			end
		end
	end
end)

-- BotÃµes de controle
Tabs.M:AddButton({
    Name = "ğŸ”„ Verificar Agora",
    Description = "ForÃ§a verificaÃ§Ã£o imediata",
    Callback = function()
        detectDripUsers()
        registerMyPresence()
        print("âœ… VerificaÃ§Ã£o forÃ§ada concluÃ­da!")
    end
})

Tabs.M:AddButton({
    Name = "ğŸ’¬ Anunciar no Chat",
    Description = "Digite /dripcheck no chat para se identificar",
    Callback = function()
        game.Players.LocalPlayer:GetMouse().KeyDown:Connect(function(key)
            if key:lower() == "p" then -- Pressione P para anunciar
                game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
                    "ğŸ”¥ DRIP CLIENT ATIVO ğŸ”¥", "All"
                )
            end
        end)
        print("ğŸ’¡ Pressione P para anunciar no chat!")
    end
})

Tabs.M:AddButton({
    Name = "ğŸ“Š Status do Sistema",
    Description = "Mostra informaÃ§Ãµes detalhadas",
    Callback = function()
        print("=== ğŸ“Š STATUS DRIP CLIENT ===")
        print("ğŸ†” Meu ID:", getgenv().ScriptID)
        print("ğŸ‘¤ Meu nome:", LocalPlayer.Name)
        print("ğŸ¯ ESP ativo:", ESPEnabled)
        print("ğŸ‘¥ UsuÃ¡rios DRIP encontrados:", 0)
        
        for name, _ in pairs(DripUsers) do
            print("  âœ… " .. name)
        end
        
        print("ğŸŒ Todos os jogadores no servidor:", 0)
        for _, player in pairs(game.Players:GetPlayers()) do
            local isDrip = DripUsers[player.Name] and "âœ…" or "âŒ"
            print("  " .. isDrip .. " " .. player.Name)
        end
        print("===========================")
    end
})

Tabs.M:AddButton({
    Name = "ğŸ§¹ Reset Sistema",
    Description = "Reinicia completamente o sistema",
    Callback = function()
        -- Limpar ESPs
        for player, _ in pairs(ESPObjects) do
            RemoveDripESP(player)
        end
        
        -- Reset variÃ¡veis
        DripUsers = {}
        onlineUsers = {}
        ESPEnabled = false
        Toggle:Set(false)
        
        -- Reinicializar
        task.wait(1)
        initialize()
        
        print("ğŸ”„ Sistema resetado e reinicializado!")
    end
})

-- InicializaÃ§Ã£o
initialize()

-- Comando de emergÃªncia via chat
game.Players.LocalPlayer.Chatted:Connect(function(message)
    if message:lower() == "/driphelp" then
        print("=== ğŸ†˜ COMANDOS DRIP CLIENT ===")
        print("/dripcheck - Anuncia presenÃ§a")
        print("/dripstatus - Mostra status")
        print("/dripreset - Reset sistema")
        print("Pressione P - Anuncia no chat")
        print("==============================")
    elseif message:lower() == "/dripstatus" then
        print("ğŸ“Š UsuÃ¡rios DRIP:", #DripUsers, "| ESP:", ESPEnabled and "ON" or "OFF")
    elseif message:lower() == "/dripreset" then
        DripUsers = {}
        for player, _ in pairs(ESPObjects) do
            RemoveDripESP(player)
        end
        print("ğŸ”„ Sistema resetado via chat!")
    end
end)
