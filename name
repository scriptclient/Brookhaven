-- DRIP CLIENT ESP System integrado com RedzLib
local redzlibContent = game:HttpGet("https://raw.githubusercontent.com/realgengar/SpeedLegends-/refs/heads/main/RedzV5.Lua", true)
local redzlib = loadstring(redzlibContent)()
if not redzlib then error("Falha ao carregar redzlib") end

workspace.FallenPartsDestroyHeight = -math.huge

-- Servi√ßos do Roblox
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer

-- Configura√ß√µes do ESP
local ESP_CONFIG = {
    ESP_ID = "DRIP_CLIENT_2024",
    MaxDistance = 800,
    UpdateRate = 0.15,
    TextSize = 16,
    ClientColor = Color3.fromRGB(255, 0, 255), -- Rosa/Magenta
    GlowColor = Color3.fromRGB(255, 100, 255)
}

-- Vari√°veis globais do ESP
local ESPObjects = {}
local ESPEnabled = false
local UpdateConnection = nil
local LastUpdate = 0
local DripUsers = {}

-- Sistema de identifica√ß√£o via RemoteEvent (m√©todo real)
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Criar RemoteEvent para identifica√ß√£o
local function GetOrCreateRemoteEvent()
    local remoteName = "DripClientIdentifier"
    local remote = ReplicatedStorage:FindFirstChild(remoteName)
    
    if not remote then
        remote = Instance.new("RemoteEvent")
        remote.Name = remoteName
        remote.Parent = ReplicatedStorage
    end
    
    return remote
end

local DripRemote = GetOrCreateRemoteEvent()

-- Sinalizar que este jogador est√° usando DRIP CLIENT
local function BroadcastDripClient()
    pcall(function()
        DripRemote:FireServer("DRIP_CLIENT_ACTIVE", ESP_CONFIG.ESP_ID)
    end)
end

-- Escutar outros jogadores sinalizando
DripRemote.OnClientEvent:Connect(function(player, message, clientId)
    if message == "DRIP_CLIENT_ACTIVE" and clientId == ESP_CONFIG.ESP_ID then
        DripUsers[player.Name] = {
            HasDrip = true,
            DetectedAt = tick(),
            LastSeen = tick(),
            Verified = true
        }
        
        -- Se ESP estiver ativo, criar ESP para este jogador
        if ESPEnabled and not ESPObjects[player] then
            CreateDripESP(player)
        end
    end
end)

-- Fun√ß√£o para verificar se jogador tem DRIP CLIENT
local function PlayerHasDripClient(player)
    local playerData = DripUsers[player.Name]
    if playerData and playerData.HasDrip and playerData.Verified then
        playerData.LastSeen = tick()
        return true
    end
    return false
end

-- Broadcast inicial
spawn(function()
    wait(2) -- Aguardar carregar
    BroadcastDripClient()
    
    -- Rebroadcast periodicamente
    while true do
        wait(30)
        BroadcastDripClient()
    end
end)

-- Fun√ß√£o para remover ESP (declarada primeiro)
local function RemoveDripESP(player)
    if ESPObjects[player] then
        local espData = ESPObjects[player]
        
        if espData.BillboardGui then
            -- Anima√ß√£o de sa√≠da
            if espData.DripLabel then
                local tween = TweenService:Create(
                    espData.DripLabel,
                    TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In),
                    {TextTransparency = 1}
                )
                tween:Play()
                
                tween.Completed:Connect(function()
                    espData.BillboardGui:Destroy()
                end)
            else
                espData.BillboardGui:Destroy()
            end
        end
        
        ESPObjects[player] = nil
    end
end

-- Fun√ß√£o para criar ESP DRIP CLIENT
local function CreateDripESP(player)
    if player == LocalPlayer then return end
    if ESPObjects[player] then return end
    if not PlayerHasDripClient(player) then return end
    
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    local head = character:FindFirstChild("Head")
    
    if not humanoid or not rootPart or not head then return end
    if not character.Parent or not head.Parent then return end
    
    -- Criar BillboardGui
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "DripESP_" .. player.Name
    billboardGui.Adornee = head
    billboardGui.Size = UDim2.new(0, 200, 0, 50)
    billboardGui.StudsOffset = Vector3.new(0, 2.5, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.Parent = head
    
    -- Frame principal
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(1, 0, 0.8, 0)
    mainFrame.BackgroundTransparency = 1
    mainFrame.Parent = billboardGui
    
    -- Label "DRIP CLIENT"
    local dripLabel = Instance.new("TextLabel")
    dripLabel.Name = "DripLabel"
    dripLabel.Size = UDim2.new(1, 0, 1, 0)
    dripLabel.Position = UDim2.new(0, 0, 0, 0)
    dripLabel.BackgroundTransparency = 1
    dripLabel.TextColor3 = ESP_CONFIG.ClientColor
    dripLabel.Font = Enum.Font.Code
    dripLabel.TextSize = ESP_CONFIG.TextSize
    dripLabel.Text = "DRIP CLIENT"
    dripLabel.TextStrokeTransparency = 0
    dripLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    dripLabel.Parent = mainFrame
    
    -- Efeito de glow
    local glowLabel = Instance.new("TextLabel")
    glowLabel.Name = "GlowLabel"
    glowLabel.Size = UDim2.new(1, 4, 1, 4)
    glowLabel.Position = UDim2.new(0, -2, 0, -2)
    glowLabel.BackgroundTransparency = 1
    glowLabel.TextColor3 = ESP_CONFIG.GlowColor
    glowLabel.Font = Enum.Font.Code
    glowLabel.TextSize = ESP_CONFIG.TextSize
    glowLabel.Text = "DRIP CLIENT"
    glowLabel.TextTransparency = 0.7
    glowLabel.ZIndex = -1
    glowLabel.Parent = mainFrame
    
    -- Nome do jogador
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
    nameLabel.Position = UDim2.new(0, 0, 0.8, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.Font = Enum.Font.Code
    nameLabel.TextSize = 12
    nameLabel.Text = player.Name
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    nameLabel.Parent = billboardGui
    
    -- Armazenar objetos
    ESPObjects[player] = {
        BillboardGui = billboardGui,
        MainFrame = mainFrame,
        DripLabel = dripLabel,
        GlowLabel = glowLabel,
        NameLabel = nameLabel,
        Character = character,
        RootPart = rootPart,
        Humanoid = humanoid,
        Head = head,
        CreatedAt = tick()
    }
    
    -- Anima√ß√£o de entrada
    dripLabel.TextTransparency = 1
    nameLabel.TextTransparency = 1
    glowLabel.TextTransparency = 1
    
    local tween1 = TweenService:Create(dripLabel, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {TextTransparency = 0})
    local tween2 = TweenService:Create(nameLabel, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out, 0, false, 0.2), {TextTransparency = 0})
    local tween3 = TweenService:Create(glowLabel, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out, 0, false, 0.1), {TextTransparency = 0.7})
    
    tween1:Play()
    tween2:Play()
    tween3:Play()
end

-- Fun√ß√£o para atualizar ESP
local function UpdateDripESP()
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return
    end
    
    local playerPos = LocalPlayer.Character.HumanoidRootPart.Position
    local currentTime = tick()
    
    for player, espData in pairs(ESPObjects) do
        if player.Character and espData.RootPart and espData.RootPart.Parent and espData.Head and espData.Head.Parent then
            -- Calcular dist√¢ncia
            local distance = (playerPos - espData.RootPart.Position).Magnitude
            
            -- Controlar visibilidade
            espData.BillboardGui.Enabled = distance <= ESP_CONFIG.MaxDistance
            
            if espData.BillboardGui.Enabled then
                -- Efeito pulsante
                local pulse = 0.8 + 0.2 * math.sin(currentTime * 4)
                espData.DripLabel.TextColor3 = Color3.fromRGB(
                    math.floor(255 * pulse),
                    0,
                    math.floor(255 * pulse)
                )
                
                -- Glow pulsante
                local glowPulse = 0.4 + 0.3 * math.sin(currentTime * 3)
                espData.GlowLabel.TextTransparency = 1 - glowPulse
                
                -- Fade por dist√¢ncia
                local fadeStart = ESP_CONFIG.MaxDistance * 0.7
                if distance > fadeStart then
                    local fadeAmount = (distance - fadeStart) / (ESP_CONFIG.MaxDistance - fadeStart)
                    local alpha = 1 - fadeAmount
                    espData.DripLabel.TextTransparency = 1 - alpha
                    espData.NameLabel.TextTransparency = 1 - (alpha * 0.8)
                end
                
                -- Anima√ß√£o de balan√ßo
                local sway = math.sin(currentTime * 2) * 0.3
                espData.BillboardGui.StudsOffset = Vector3.new(sway, 2.5, 0)
            end
        else
            RemoveDripESP(player)
        end
    end
end

-- Fun√ß√£o para limpar todos os ESPs
local function ClearAllDripESP()
    for player, _ in pairs(ESPObjects) do
        RemoveDripESP(player)
    end
    ESPObjects = {}
end

-- Fun√ß√£o principal para ativar/desativar ESP
local function ToggleDripESP(enabled)
    ESPEnabled = enabled
    
    if ESPEnabled then
        print("üî• DRIP CLIENT ESP ATIVADO")
        
        -- Criar ESP para jogadores existentes
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character then
                CreateDripESP(player)
            end
        end
        
        -- Loop de atualiza√ß√£o
        UpdateConnection = RunService.Heartbeat:Connect(function()
            local currentTime = tick()
            if currentTime - LastUpdate >= ESP_CONFIG.UpdateRate then
                UpdateDripESP()
                LastUpdate = currentTime
            end
        end)
        
    else
        print("‚ùå DRIP CLIENT ESP DESATIVADO")
        
        if UpdateConnection then
            UpdateConnection:Disconnect()
            UpdateConnection = nil
        end
        
        ClearAllDripESP()
    end
end

-- Verificar novos jogadores
local function CheckForNewDripUsers()
    if not ESPEnabled then return end
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and not ESPObjects[player] and player.Character then
            CreateDripESP(player)
        end
    end
end

-- Eventos de jogadores
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if ESPEnabled then
            wait(1.5)
            CreateDripESP(player)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(player)
    RemoveDripESP(player)
    if DripUsers[player.Name] then
        DripUsers[player.Name] = nil
    end
end)

-- Loop de verifica√ß√£o
spawn(function()
    while true do
        wait(3)
        CheckForNewDripUsers()
        
        -- Limpar dados antigos (apenas n√£o verificados)
        local currentTime = tick()
        for playerName, data in pairs(DripUsers) do
            if not data.Verified and currentTime - data.LastSeen > 60 then
                DripUsers[playerName] = nil
            elseif data.Verified and currentTime - data.LastSeen > 300 then
                DripUsers[playerName] = nil
            end
        end
    end
end)

-- Verificar recarregamento de personagens
spawn(function()
    while true do
        wait(2)
        if ESPEnabled then
            for player, espData in pairs(ESPObjects) do
                if player.Character ~= espData.Character then
                    RemoveDripESP(player)
                    if player.Character then
                        CreateDripESP(player)
                    end
                end
            end
        end
    end
end)

-- Interface RedzLib
local Window = redzlib:MakeWindow({
    Title = "Drip Client : Brookhaven ",
    SubTitle = "          by: Magnus999",
    SaveFolder = "redz Hub | Brookhaven RP.lua"
})

Window:AddMinimizeButton({
    Button = {
        Image = "rbxassetid://72495850369898"
    },
    Corner = {
        CornerRadius = UDim.new(0, 2)
    },
    Stroke = {
        Color = Color3.new(0, 0, 0),
        Transparency = 1,
        Thickness = 1
    }
})

local Tabs = {
    M = Window:MakeTab({"Informa√ß√µes", "Info"}),
    H = Window:MakeTab({"In√≠cio", "flower"})
}

-- Toggle do ESP
local ESPToggle = Tabs.H:AddToggle({
    Name = "DRIP CLIENT ESP", 
    Description = "Mostra 'DRIP CLIENT' em jogadores usando o mesmo c√≥digo", 
    Default = false
})

ESPToggle:Callback(function(Value)
    ToggleDripESP(Value)
end)

-- Informa√ß√µes na aba Info
Tabs.M:AddParagraph({
    Title = "üî• DRIP CLIENT ESP",
    Description = "Sistema que detecta APENAS jogadores usando o mesmo c√≥digo DRIP CLIENT.\n\n‚Ä¢ Detec√ß√£o via RemoteEvent\n‚Ä¢ Apenas usu√°rios reais do script\n‚Ä¢ Mostra 'DRIP CLIENT' em rosa pulsante\n‚Ä¢ Nome do jogador abaixo\n‚Ä¢ Efeitos visuais suaves"
})

Tabs.M:AddParagraph({
    Title = "‚ÑπÔ∏è Como funciona",
    Description = "O sistema usa comunica√ß√£o via RemoteEvent para identificar jogadores que realmente est√£o usando o DRIP CLIENT.\n\nApenas jogadores com o script ativo aparecer√£o marcados!"
})

print("üî• DRIP CLIENT System Loaded!")
print("Use a GUI para ativar o ESP!")
