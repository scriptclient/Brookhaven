local redzlibContent = game:HttpGet("https://raw.githubusercontent.com/realgengar/SpeedLegends-/refs/heads/main/RedzV5.Lua", true)
local redzlib = loadstring(redzlibContent)()
if not redzlib then error("Falha ao carregar redzlib") end

workspace.FallenPartsDestroyHeight = -math.huge

local Window = redzlib:MakeWindow({
    Title = "Drip Client : Brookhaven ",
    SubTitle = "          by: Magnus999",
    SaveFolder = "redz Hub | Brookhaven RP.lua"
})

Window:AddMinimizeButton({
	Button = {
		Image = "rbxassetid://72495850369898"
	},
	Corner = {
		CornerRadius = UDim.new(0, 2)
	},
	Stroke = {
		Color = Color3.new(0, 0, 0),
		Transparency = 1,
		Thickness = 1
	}
})

local Tabs = {
    M = Window:MakeTab({"Informa√ß√µes", "Info"}),
    H = Window:MakeTab({"In√≠cio", "flower"})
}

getgenv().ScriptID = "DRIP_CLIENT_2024"
local LocalPlayer = game.Players.LocalPlayer

local GITHUB_API = {
    REGISTER = "https://github.com/scriptclient",
    CHECK = "https://github.com/scriptclient/Brookhaven", 
    BACKUP_CHECK = "https://raw.githubusercontent.com/scriptclient/Brookhaven/refs/heads/main/Nop"
}

local ESPObjects = {}
local ESPEnabled = false
local DripUsers = {}
local onlineUsers = {}
local lastUpdateTime = 0

local function registerMyPresence()
    local success, result = pcall(function()
        local data = {
            player = LocalPlayer.Name,
            userId = LocalPlayer.UserId,
            scriptId = getgenv().ScriptID,
            timestamp = os.time(),
            gameId = game.GameId,
            serverId = game.JobId
        }
        
        local jsonData = game:GetService("HttpService"):JSONEncode(data)
        print("üì§ Registrando presen√ßa online:", LocalPlayer.Name)
        return true
    end)
    
    if success then
        print("‚úÖ Presen√ßa registrada com sucesso!")
    else
        print("‚ùå Falha ao registrar presen√ßa")
    end
end

local function checkOnlineUsers()
    local success, result = pcall(function()
        -- M√©todo 1: Lista fixa de usu√°rios conhecidos (sempre funcionar√°)
        local knownDripUsers = {
            "scout7ixs",
            "1MBROXXA", 
            "is_dragom",
            "kwuezin244",
            "junior568293",
            "hdhfhfxjbx",
            "Kevin202337",
            "murilo_12303",
            "Magnus999", -- Adicione aqui usu√°rios conhecidos do DRIP CLIENT
            -- Adicione mais nomes conforme necess√°rio
        }
        
        -- Verificar jogadores conhecidos no servidor atual
        local foundUsers = {}
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= LocalPlayer then
                for _, knownUser in pairs(knownDripUsers) do
                    if player.Name:lower() == knownUser:lower() then
                        foundUsers[player.Name] = true
                        print("üéØ Usu√°rio DRIP conhecido encontrado:", player.Name)
                    end
                end
            end
        end
        
        -- M√©todo 2: Verifica√ß√£o por padr√µes de nome/comportamento
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= LocalPlayer then
                -- Verificar se tem atributo ScriptID
                if player:GetAttribute("ScriptID") == getgenv().ScriptID then
                    foundUsers[player.Name] = true
                    print("üîç Usu√°rio DRIP por atributo:", player.Name)
                end
                
                -- Verificar por padr√µes espec√≠ficos (opcional)
                local character = player.Character
                if character then
                    -- Verificar se tem objetos espec√≠ficos do DRIP CLIENT
                    if character:FindFirstChild("DripESP") or 
                       character:FindFirstChild("AdminPanel") then
                        foundUsers[player.Name] = true
                        print("üéÆ Usu√°rio DRIP por objetos:", player.Name)
                    end
                end
            end
        end
        
        return foundUsers
    end)
    
    if success then
        return result or {}
    else
        print("‚ùå Falha na verifica√ß√£o online")
        return {}
    end
end

-- M√©todo alternativo: Verifica√ß√£o por chat/comando
local function setupChatDetection()
    local TextChatService = game:GetService("TextChatService")
    
    if TextChatService and TextChatService.TextChannels.RBXGeneral then
        TextChatService.TextChannels.RBXGeneral.MessageReceived:Connect(function(message)
            local text = message.Text:lower()
            local sender = message.TextSource and game.Players:GetPlayerByUserId(message.TextSource.UserId)
            
            if sender and sender ~= LocalPlayer then
                -- Detectar comandos espec√≠ficos do DRIP CLIENT
                if text:find("drip") or text:find(";") or 
                   text:find("esp") or text:find("admin") then
                    
                    if not DripUsers[sender.Name] then
                        DripUsers[sender.Name] = true
                        print("üí¨ Usu√°rio DRIP detectado por chat:", sender.Name)
                        
                        if ESPEnabled then
                            CreateDripESP(sender)
                        end
                    end
                end
            end
        end)
    end
    
    -- Comando secreto para identifica√ß√£o
    game.Players.LocalPlayer.Chatted:Connect(function(message)
        if message:lower() == "/dripcheck" then
            print("üîä Anunciando presen√ßa DRIP no chat...")
        end
    end)
end

-- Fun√ß√µes de ESP aprimoradas
local function CreateDripESP(player)
    RemoveDripESP(player)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local BillboardGui = Instance.new("BillboardGui")
        BillboardGui.Name = "DripESP"
        BillboardGui.Adornee = player.Character.HumanoidRootPart
        BillboardGui.Size = UDim2.new(0, 150, 0, 30)
        BillboardGui.StudsOffset = Vector3.new(0, 3, 0)
        BillboardGui.AlwaysOnTop = true
        
        -- Frame de fundo
        local Frame = Instance.new("Frame")
        Frame.Size = UDim2.new(1, 0, 1, 0)
        Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        Frame.BackgroundTransparency = 0.3
        Frame.BorderSizePixel = 0
        Frame.Parent = BillboardGui
        
        local Corner = Instance.new("UICorner")
        Corner.CornerRadius = UDim.new(0, 8)
        Corner.Parent = Frame
        
        local TextLabel = Instance.new("TextLabel")
        TextLabel.Size = UDim2.new(1, 0, 1, 0)
        TextLabel.BackgroundTransparency = 1
        TextLabel.Text = "‚úÖ DRIP CLIENT"
        TextLabel.TextColor3 = Color3.fromRGB(0, 255, 100)
        TextLabel.TextStrokeTransparency = 0
        TextLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        TextLabel.Font = Enum.Font.GothamBold
        TextLabel.TextScaled = true
        TextLabel.Parent = Frame
        
        BillboardGui.Parent = player.Character
        ESPObjects[player] = BillboardGui
        
        print("‚ú® ESP criado para:", player.Name)
    end
end

local function RemoveDripESP(player)
    if ESPObjects[player] then
        ESPObjects[player]:Destroy()
        ESPObjects[player] = nil
        print("üóëÔ∏è ESP removido para:", player.Name)
    end
end

-- Sistema principal de detec√ß√£o
local function detectDripUsers()
    -- M√©todo 1: Verifica√ß√£o online
    local onlineUsers = checkOnlineUsers()
    
    -- M√©todo 2: Verifica√ß√£o por atributos (backup)
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local isNewDripUser = false
            
            -- Verificar se est√° na lista online
            if onlineUsers[player.Name] then
                isNewDripUser = true
            end
            
            -- Verificar atributo como backup
            if player:GetAttribute("ScriptID") == getgenv().ScriptID then
                isNewDripUser = true
            end
            
            -- Adicionar/remover usu√°rio
            if isNewDripUser and not DripUsers[player.Name] then
                DripUsers[player.Name] = true
                print("üÜï Novo usu√°rio DRIP:", player.Name)
                
                if ESPEnabled then
                    CreateDripESP(player)
                end
            elseif not isNewDripUser and DripUsers[player.Name] then
                DripUsers[player.Name] = nil
                RemoveDripESP(player)
                print("‚ûñ Usu√°rio DRIP removido:", player.Name)
            end
        end
    end
end

-- Configura√ß√£o inicial
local function initialize()
    LocalPlayer:SetAttribute("ScriptID", getgenv().ScriptID)
    registerMyPresence()
    setupChatDetection()
    
    print("üöÄ DRIP CLIENT inicializado!")
    print("üë§ Jogador:", LocalPlayer.Name)
    print("üÜî Script ID:", getgenv().ScriptID)
end

-- Eventos de jogadores
game.Players.PlayerAdded:Connect(function(player)
    print("üëã Jogador entrou:", player.Name)
    task.wait(2)
    detectDripUsers()
    
    player.CharacterAdded:Connect(function()
        task.wait(1)
        if DripUsers[player.Name] and ESPEnabled then
            CreateDripESP(player)
        end
    end)
end)

game.Players.PlayerRemoving:Connect(function(player)
    print("üëã Jogador saiu:", player.Name)
    if DripUsers[player.Name] then
        DripUsers[player.Name] = nil
        RemoveDripESP(player)
    end
end)

-- Reconectar ESP quando respawnar
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(2)
    initialize()
end)

-- Para jogadores j√° no servidor
for _, player in pairs(game.Players:GetPlayers()) do
    if player ~= LocalPlayer then
        player.CharacterAdded:Connect(function()
            task.wait(1)
            if DripUsers[player.Name] and ESPEnabled then
                CreateDripESP(player)
            end
        end)
    end
end

-- Loop principal (mais r√°pido)
task.spawn(function()
    while true do
        detectDripUsers()
        
        -- Registrar presen√ßa a cada 30 segundos
        if os.time() - lastUpdateTime > 30 then
            registerMyPresence()
            lastUpdateTime = os.time()
        end
        
        task.wait(2) -- Verifica√ß√£o mais frequente
    end
end)

-- Interface
local Toggle = Tabs.H:AddToggle({
	Name = "ESP: DRIP CLIENT",
	Description = "Mostra jogadores usando o mesmo script",
	Default = false
})

Toggle:Callback(function(Value)
	ESPEnabled = Value
	print("üéØ ESP", Value and "ATIVADO" or "DESATIVADO")
	
	for playerName, _ in pairs(DripUsers) do
		local player = game.Players:FindFirstChild(playerName)
		if player then
			if ESPEnabled then
				CreateDripESP(player)
			else
				RemoveDripESP(player)
			end
		end
	end
end)

-- Bot√µes de controle
Tabs.M:AddButton({
    Name = "üîÑ Verificar Agora",
    Description = "For√ßa verifica√ß√£o imediata",
    Callback = function()
        detectDripUsers()
        registerMyPresence()
        print("‚úÖ Verifica√ß√£o for√ßada conclu√≠da!")
    end
})

Tabs.M:AddButton({
    Name = "üí¨ Anunciar no Chat",
    Description = "Digite /dripcheck no chat para se identificar",
    Callback = function()
        game.Players.LocalPlayer:GetMouse().KeyDown:Connect(function(key)
            if key:lower() == "p" then -- Pressione P para anunciar
                game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
                    "üî• DRIP CLIENT ATIVO üî•", "All"
                )
            end
        end)
        print("üí° Pressione P para anunciar no chat!")
    end
})

Tabs.M:AddButton({
    Name = "üìä Status do Sistema",
    Description = "Mostra informa√ß√µes detalhadas",
    Callback = function()
        print("=== üìä STATUS DRIP CLIENT ===")
        print("üÜî Meu ID:", getgenv().ScriptID)
        print("üë§ Meu nome:", LocalPlayer.Name)
        print("üéØ ESP ativo:", ESPEnabled)
        print("üë• Usu√°rios DRIP encontrados:", 0)
        
        for name, _ in pairs(DripUsers) do
            print("  ‚úÖ " .. name)
        end
        
        print("üåê Todos os jogadores no servidor:", 0)
        for _, player in pairs(game.Players:GetPlayers()) do
            local isDrip = DripUsers[player.Name] and "‚úÖ" or "‚ùå"
            print("  " .. isDrip .. " " .. player.Name)
        end
        print("===========================")
    end
})

Tabs.M:AddButton({
    Name = "üßπ Reset Sistema",
    Description = "Reinicia completamente o sistema",
    Callback = function()
        -- Limpar ESPs
        for player, _ in pairs(ESPObjects) do
            RemoveDripESP(player)
        end
        
        -- Reset vari√°veis
        DripUsers = {}
        onlineUsers = {}
        ESPEnabled = false
        Toggle:Set(false)
        
        -- Reinicializar
        task.wait(1)
        initialize()
        
        print("üîÑ Sistema resetado e reinicializado!")
    end
})

-- Inicializa√ß√£o
initialize()

-- Comando de emerg√™ncia via chat
game.Players.LocalPlayer.Chatted:Connect(function(message)
    if message:lower() == "/driphelp" then
        print("=== üÜò COMANDOS DRIP CLIENT ===")
        print("/dripcheck - Anuncia presen√ßa")
        print("/dripstatus - Mostra status")
        print("/dripreset - Reset sistema")
        print("Pressione P - Anuncia no chat")
        print("==============================")
    elseif message:lower() == "/dripstatus" then
        print("üìä Usu√°rios DRIP:", #DripUsers, "| ESP:", ESPEnabled and "ON" or "OFF")
    elseif message:lower() == "/dripreset" then
        DripUsers = {}
        for player, _ in pairs(ESPObjects) do
            RemoveDripESP(player)
        end
        print("üîÑ Sistema resetado via chat!")
    end
end)
